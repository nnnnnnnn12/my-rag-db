<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>æˆ‘çš„ RAG åŠ©æ‰‹æœºå™¨äºº</title>
    <style>
        body { font-family: sans-serif; max-width: 600px; margin: 50px auto; background: #f4f7f6; }
        #chat-box { height: 400px; border: 1px solid #ddd; background: #fff; overflow-y: auto; padding: 15px; border-radius: 8px; margin-bottom: 10px; }
        .user { text-align: right; color: #2c3e50; margin: 5px 0; }
        .ai { text-align: left; color: #27ae60; margin: 5px 0; background: #e8f5e9; padding: 8px; border-radius: 5px; }
        .input-area { display: flex; gap: 10px; }
        input { flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 4px; }
        button { padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
    </style>
</head>
<body>
    <h2>ğŸ¤– RAG çŸ¥è¯†åº“åŠ©æ‰‹</h2>
    <div id="chat-box"></div>
    <div class="input-area">
        <input type="text" id="userInput" placeholder="è¾“å…¥å…³é”®è¯ï¼Œå¦‚ï¼šæ°”æ¸©...">
        <button onclick="sendMsg()">å‘é€</button>
    </div>

    <script>
        async function sendMsg() {
            const input = document.getElementById('userInput');
            const chatBox = document.getElementById('chat-box');
            if (!input.value) return;

            // æ˜¾ç¤ºç”¨æˆ·æ¶ˆæ¯
            chatBox.innerHTML += `<div class="user">æˆ‘: ${input.value}</div>`;
            
            try {
            
                // --- ç²˜è´´è¿™æ®µæ–°çš„æµå¼å¤„ç†é€»è¾‘ ---
              const response = await fetch(`http://localhost:8080/chat?q=${encodeURIComponent(input.value)}`);
              const reader = response.body.getReader();
              const decoder = new TextDecoder();

               // å…ˆåˆ›å»ºä¸€ä¸ªç©ºçš„ AI å›ç­”æ¡†
               let aiDiv = document.createElement('div');
               aiDiv.className = 'ai';
                  aiDiv.innerHTML = '<b>AI:</b> ';
                   chatBox.appendChild(aiDiv);

            while (true) {
               const { done, value } = await reader.read();
                 if (done) break;
    
    const chunk = decoder.decode(value);
    const lines = chunk.split('\n');
    
    for (let line of lines) {
        if (line.startsWith('data: ') && line !== 'data: [DONE]') {
            try {
                const data = JSON.parse(line.substring(6));
                const content = data.choices[0].delta.content || "";
                // å®æ—¶æŠŠæ–°å­—è¿½åŠ åˆ°ç½‘é¡µä¸Š
                aiDiv.innerHTML += content.replace(/\n/g, '<br>');
                chatBox.scrollTop = chatBox.scrollHeight;
            } catch (e) { /* å¿½ç•¥è§£æé”™è¯¯ */ }
        }
    }
}
            } catch (err) {
                chatBox.innerHTML += `<div class="ai" style="color:red">é”™è¯¯: æ— æ³•è¿æ¥åˆ°åç«¯</div>`;
            }
            
            input.value = '';
            chatBox.scrollTop = chatBox.scrollHeight;
        }
    </script>
</body>
</html>